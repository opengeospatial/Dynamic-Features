[[geometry_in_3_d_section]]
=== Geometry in 3 Dimensions

The applicable OGC/ISO standard for geometries is ISO 19107:2003. While a new version was approved in 2019, it hasn't propagated through the rest of the ISO standards baseline. As a result, 19107:2003 is the most recent implemented version. 

==== Features and Geometry

The General Feature Model treats geometry as an attribute of the Feature. In addition, it defines three types of attribute which are useful for associating geometry with a Feature in a standard manner: 

* SpatialAttributeType: Geometries (GM_Object) and Topologies (TP_Object)
* LocationalAttributeType: Named locations, extents, and points.
* TemporalAttributeType: Temporal objects (TM_Object)

image::images/AttributeTypes.png[align="center"]

image::images/SpatialAttributeType.png[align="center"]

image::images/LocationalAttributeType.png[align="center"]

image::images/TemporalAttributeType.png[align="center"]

==== The Geometry Model

An important feature of the ISO Geometry Model is that it does not specify or assume a coordinate reference system. The SC_CRS class, defined in ISO 19111, is used to define a coordinate reference system. The "Coordinate Reference System" association is used to associate a GM_Object instance with the appropriate SC_CRS instance. Since all geometry classes are decended from GM_Object, any geometry object can have its own unique coordinate reference system.

image::images/GM_Object.png[align="center"]

While the ISO Geometry Model is very complex, at its core is the DirectPosition class. This is the fundamental specification of a position within a coordinate reference system. Its purpose is simply to hold the coordinates for a position within the coordinate reference system. 

image::images/DirectPosition.png[align="center"]

The DirectPosition class contains two attributes, "dimension" and "coordinate". The "coordinate" attribute is a sequence of numbers. Each number represents the location of the DirectPosition on a coordinate axis. There are no constraints on the number of numbers in the sequence. Therefore, a DirectPosition can represent an unlimited number of dimensions. The "dimension" attribute specifies the number of axis in the applicable coordinate reference system. This corresponds to the number of values in the "coordinate" sequence.

Like GM_Object, DirectPositions are associated with an SC_CRS through the cordinateReferenceSystem association. This association is typically not used since DirectPositions, as data types, will usually be included in larger objects (such as GM_Objects) that have their own references to SC_CRS. When this association is left NULL, the coordinate reference system of the DirectPosition instance will take on the value of the containing object's SC_CRS.

One limitation of the DirectPosition class is that it does not support complex numbers. However, since DirectPosition does have a "coordinateReferencesystem" association with SC_CRS, it should be possible to model complex numbers in the CRS definition as as two orthagonal axis.

*Conclusion:* The ISO 19107 Geometry Model is suitable for geometries of three or more dimensions.

*Issue:* Support for coordinate values which are complex numbers needs to be validated.

==== Features in 3D

In our discussion of Dynamic Features, we must allow for Features which are moving through three dimensions and have non-trivial three dimensional shapes. We must also consider that the shape of these objects may change with time. From this we see that the movement of the Feature and the shape of the Feature are two separate properties. 

A measurement of movement would capture changes in location and orientation. Movement is measured from the perspective of an external observer. Therefore, movement should be specified using a coordinate reference system which is external to the Feature.

The shape of a Feature is independent of its location. A rigid body has the same shape regardless of where it is or who is observing it. It's geometry should be self-contained. This requires use of an internal coordinate reference system.

This leads up to two postulates:

*Postulate 1:* The Locational Attribute of a 3D Feature is a GM_Point which locates the origin of the local CRS within an <<external_coordinate_reference_system_definition,external CRS>>.

*Postulate 2:* The Spatial Attribute of a 3D Feature is one or more GM_Objects which define the shape of the Feature in the <<local_coordinate_reference_system_definition,local coordinate refrence system>>.

===== 3D Geometries 

ISO 19107 makes a distinction between a geometric object and the surface which contains that object. One advantage of this approach is that there can be multiple surfaces associated with one object. For example, an island located in a lake would be represented by an interior surface (the island) of a polygon (the lake) bounded by the exterior surface (the shoreline). 

ISO 19107 uses the GM_Object class to define an object and the GM_Boundary class to define a containing surface. Both GM_Object and GM_Boundary are defines as root level geometry classes. The association between GM_Object and GM_Boundary is achieved through the “boundary()” operation on the GM_Object class. This operation is inherited by all subclasses of GM_Object.

In the case of a 3D Feature, GM_Solid is the subclass of GM_Object while GM_SolidBoundary is the subclass of GM_Boundary. GM_Solid describes the volume while GM_SolidBoundary describes the shape. Notice that GM_SolidBoundary includes both interior and exterior surfaces.

image::images/Geometry_3D.png[]

An example of this Geometry Model applied to a practical application can be found in the CityGML family of standards. CityGML uses the 19107 geometry model to define buildings, the exterior spaces surounding the buildings, as well as interior spaces and even movable furniture. This should be sufficient for any complex object, whether on the surface of the Earth or in Space. 

*Conclusion:* The ISO 19107 Geometry Model is sufficient to represent the geometry of complex space objects.

There are a number of techniques in use to represent the surface of a 3D object. These include point clouds, triangulated or polygonal surfaces, and tesselated surfaces. A GM_SolidBoundary is componsed of GM_Shell objects. But ISO 19107 does not provide a decomposition of GM_Shell. So there is no way to specify the geometry underlying the shell. 

*Issue:* Can and should we extend the GM_Shell class of ISO 19107 to address the underlying geometry of the surface of a 3D object?

The GM_Solid and GM_SolidBoundary classes are designed to represent a 3D space. It is not clear if they can also represent a 4D or even 5D space. While it's clear that the basic coordinate representation is independent of the number of dimensions, that may not be true of the more complex geometry constructs.

*Issue:* Can the GM_Solid and GM_SolidBoundary classes represent an n-dimensional solid?

Note: the following sectons should be integated into the text above.

===== Volumetrics

GM_Object is subclassed into GM_Primitive and then into GM_Solid.  The “volume()” operation on GM_Solid returns the volume (defined in ISO 19103) associated with a Feature. Thus, ISO 19107 supports the concept of a 3D volume.

Real 3D objects are often not solid. So the 3D model must also support voids, or even entire 3D Features within their interior. GM_Primitive addresses this need through the “interior to” association. The two roles on this association are the containingPrimitive (the GM_Primitive which contains another GM_Primitive) and the containedPrimitive (the GM_Primitive which is contained). This association has proven its worth in 2D space so there is little doubt that it will be just as effective in 3D.

===== Boundaries

A 3D volume is delineated by a bounding surface.  GM_Boundary is the root class for boundaries. The subclass GM_PrimitiveBoundary provides the boundary for GM_Primitives. The GM_PrimitiveBoundary subclass GM_SolidBoundary is defined as the boundary for a GM_Solid.

image::images/Boundary_3D.png[]

ISO 19107 goes even farther. A GM_SolidBoundary is composed of both interior and exterior boundaries. These boundaries are defined by the GM_Shell class. Following the class associations we see:

* A GM_Shell is a GM_CompositeSurface
* A GM_CompositeSurface is composed of
GM_OrientablePrimitives
* A GM_Surface is a type of GM_OrientablePrimitive
* A GM_PolyhedralSurface is a type of GM_Surface
* A GM_PolyhedralSurface can be composed of
GM_Polygons 

A surface constructed of polygons is an example of Boundary Representation (B-Rep) of a surface. This approach is fundamental to rendering 3D computer graphics. (ref Adam Powers 1981)

====== Closure Surfaces

Some structures, such as a tunnel or overpass, pose difficulties for this geometry model. The boundary surface can be constructed so that it continues into the interior of the structure. That would make the interior of a tunnel external to the tunnel object. This is not always a desireable result. CityGML provides the concept of a "Closure Surface".

A Closure Surface is a surface which is a logical part of the object but does not correspond to a physical part of the object. For example, the entrance to a tunnel can have a closure surface. This surface allows you to treat the tunnel as a three-dimension solid, even though there is a hole in the bounding surface.

image::images/Closure_Surface.png[]

As implemented in CityGML 3.0, the ClosureSurface class has quite an ancestory. We may want to generalize this concept for use outside of CityGML. However, the capabilties provided by the ancestor classes do provide value and may be worth incorporating into a general 3D model.

====== B-Rep

The polyhedral surfaces which bound volumetric shapes are similar to the Boundary Representation (B-Rep) approach used in CAD and computer graphics. B-Rep defines a 3-dimensional surface which serves as the interface between the interior of the volumetric shape and the exterior. This surface is usually defined by a collection of shape elements (polygons) which together form a closed surface. 

https://en.wikipedia.org/wiki/Boundary_representation

====== Point Clouds

Boundary surfaces can also be defined using 3D point clouds. This allows the spatial represention a bounding surface by a set of points located on that surface. In this way, the geometry of a Feature could, for instance, be modelled directly from the result of a mobile laser scanning campaign. 

