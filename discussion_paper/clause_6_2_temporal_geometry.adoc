=== Moving Features

*Topic:* Is the OGC geometry model sufficient to support 3D Moving Features?

ISO 19141 is the standard for Moving Features. It introduces Feature Properties whose values are a function of an input parameter. Typically that parameter is time.

image::images/Movement.png[]

==== Basic Concepts

*Volume and Boundary surface*

ISO 19107 provides us with the GM_Object and GM_Boundary classes. GM_Object represents the space that is occupied by a geometry. GM_Boundary represents a surface which forms the boundary between inside and outside of the associated GM_Object. GM_Object and GM_Boundary are both specialized according to the number of dimensions they support. 

*Location and shape*

The location of a Feature is a single GM_Point which represents its current position in the universe. GM_Point is a geometry of zero dimensions, but is specified with values of all of the applicable coordinate axis. 

The Shape of a Feature is the bounding geometry. Shape tells you nothing about where a Feature is but does specify the volume of the space it occupies. 

*Coordinate systems*

image::images/LocalGlobalCRS.png[]

Moving Features deal with three spatial coordinate systems; External, Global, and Local.

The External coordinate system is the coordinate system within which the Moving Feature exists. Typically this is an Earth-centric geographic CRS.

The Global coordinate system is describes the area external to the Feature at a specific time. It is mostly used to identify the loctation and orientation of the Feature in regards to the path (tranjectory) in which it is traveling.

The local coordinate system is internal to the Feature. This is usually a cartisian coordinate system with the origin at a prominant point in the Feature such as the center of mass. The origin of the local coordinate system should also be the point where the location and orientation of the Feature is measured.

==== MF_OneParameterGeometry

We start our discussion with the class MF_OneParameterGeometry. MF_OneParameterGeometry is a subclass of GM_Object. So moving features have the 3D geometric properties of any other GM_Object. What is different is that this geometry can change as a function of a parameter. 
A one parameter set of geometries is defined as "a function f from an interval t Î [a, b] such that f(t) is a geometry and for each point P Î f(a) there is a one parameter set of points (called the trajectory of P) P(t) : [a, b] ® P(t) such that P(t) Î f(t). A leaf of a one parameter set of geometries is the geometry f(t) at a particular value of the parameter". 

A one parameter geometry instance includes a "leafgeometry()" operation. This operation takes the parameter (t) as input and returns the leaf P(t) for that parameter as a GM_Object.   

==== MF_TemporalGeometry

An MF_TemporalGeometry is a MF_OneParameterGeometry where the parameter is Time expressed as a TM_Coordinate. TM_Coordinate is specified in ISO 19108; it expresses time as a multiple of a single unit of measure such as year, day, or second. The "leafgeometry()" operation of an instance of MF_TemporalGeometry would take a TM_Coordinat in as input and return a GM_Object instance representing the geometry of the Feature at the specified point in time.

==== Temporal Properties

The JSON encoding of the OGC Moving Features standard introduces the concept of temporal properties. 

"A TemporalProperties object is a JSON array of ParametricValues objects that groups a collection of dynamic non-spatial attributes and its parametric values with time."

Logically TemporalProperties should be a subclass of OneParamProperties. Since Geometry is a property, then MF_TemporalGeometry should be a subclass of TemporalProperties. Which gives us the following UML.

image::images/Temporal_Properties.png[]

Temporal properties are particularly useful for capturing state change. For example, the fuel load of an aircraft will change over time. The leafproperty() operation on a temporal fuel_load object would return the amount of fuel onboard at the specified time.

==== MF_TemporalTrajectory

A trajectory is a curve (GM_Curve) which represents the path that a Moving Feature takes as it moves. In other words, it represents the location of the Feature as a function of time. 

image::images/MF_Trajectory.png[]

A Trajectory has two operations of particular interest; leaf() and leafgeometry(). The parameter for a Temporal Trajectory is always time (TM_Coordinate). One limitation of a trajectory is that it only represents location and orientation. 

The leaf() operation returns the direct position that the trajectory passes at that value of the trajectory parameter. This is a point on the trajectory GM_Curve geometry. It typically serves as the origin of the Global CRS with the local tangent designating the X axis. 

The LeafGeometry() operation returns the GM_Point that is at that position on the trajectory. This is the geometry of the Moving Feature expressed in the Local CRS. Since trajectories only convey location, only GM_Point geometries are supported.

==== MF_PrismGeometry

image::images/Foliation.png[]

A Prism Geometry provides additional geometric information for a trajectory.   

image::images/prism.png[]

A trajectory provides the location of a Moving Feature as a function of time. Prism Geometry represents the full geometry (location, orientaion, and shape) of the Feature as a function of time. 

Like a Temporal Trajectory, a Prism is a subclass of MF_TemporalGeometry. Prisms and Trajectories work together to provide this representation

The association role "originTrajectory" associates a Temporal Trajectory with a Prism. For any TM_Position, the associated Temporal Trajectory provides the location of the Moving Feature in the Global CRS. This point serves as the origin of the Local CRS.

The localCoordinateSystem() operation returns a SC_CRS for the design coordinate reference system in which the moving feature's shape is defined.

The rotationAtTime() operation accepts a time in the domain of the prism geometry and returns the rotation matrix that embeds the local geometry into geographic space at a given time (TM_Coordinate). The vectors of the rotation matrix allow the feature to be aligned and scaled as appropriate to the vectors of the global coordinate reference system.

This one association and two operations provide us with the location, orientation, axis definition, and units of measure needed to define identify the local CRS and to transform geometries between the Local and Global CRS.

Finally, the geometryAtTime() operation accepts a time in the domain of the prism geometry and returns the geometry of the moving feature, as it is at a given time in the global coordinate reference system. The return type is a GM_Object so this operation is not limited to points. It is fully capable of representing a 3D surface and volume.

==== Non-rigid Bodies

ISO 19141 only addresses rigid bodies. The shape returned by a geometryAtTime() operation will always be the same. However, it leaves open the opportunity to extend the Moving Feature model to support plastic (non-rigid) objects.

ISO 19141 postulates that trajectories can be used to represent non-rigid Features. This requires that each node on the geometry of the surface have its own trajectory. The shape of the Feature is defined by the bundle of trajectories for the surface points. 

An alternate approach is to take advantage of temporal geometry to capture changes in the shape of a Feature as a function of time. 

There are arguments for and against each approach. And an opportunity to do some valuable work.

